From 1d5dcb1ea1fd4090f71ac2df396e3081c8b4c1f2 Mon Sep 17 00:00:00 2001
From: Madelen Andersson <madelan@axis.com>
Date: Tue, 13 Jun 2023 13:13:16 +0200
Subject: [PATCH] change debian stretch repositories

Change-Id: I28c3f636f6d85bf36dd536b57dbdba288bf49e4c
---
 Dockerfile | 9 +++++----
 1 file changed, 5 insertions(+), 4 deletions(-)

diff --git a/Dockerfile b/Dockerfile
index f269457eff..b30f238940 100644
--- a/Dockerfile
+++ b/Dockerfile
@@ -14,8 +14,9 @@ ARG GOLANG_IMAGE="golang:${GO_VERSION}-${BASE_DEBIAN_DISTRO}"
 FROM ${GOLANG_IMAGE} AS base
 RUN echo 'Binary::apt::APT::Keep-Downloaded-Packages "true";' > /etc/apt/apt.conf.d/keep-cache
 ARG APT_MIRROR
-RUN sed -ri "s/(httpredir|deb).debian.org/${APT_MIRROR:-deb.debian.org}/g" /etc/apt/sources.list \
- && sed -ri "s/(security).debian.org/${APT_MIRROR:-security.debian.org}/g" /etc/apt/sources.list
+RUN echo 'deb http://archive.debian.org/debian/ stretch main contrib non-free' > /etc/apt/sources.list \
+ && echo 'deb http://archive.debian.org/debian/ stretch-proposed-updates main contrib non-free' >> /etc/apt/sources.list \
+ && echo 'deb http://archive.debian.org/debian-security stretch/updates main contrib non-free' >> /etc/apt/sources.list
 ENV GO111MODULE=off
 
 FROM base AS criu
@@ -122,7 +123,7 @@ ARG DEBIAN_FRONTEND
 RUN echo 'deb http://deb.debian.org/debian buster-backports main' > /etc/apt/sources.list.d/backports.list
 RUN --mount=type=cache,sharing=locked,id=moby-cross-false-aptlib,target=/var/lib/apt \
     --mount=type=cache,sharing=locked,id=moby-cross-false-aptcache,target=/var/cache/apt \
-        apt-get update && apt-get install -y --no-install-recommends \
+        apt-get update && apt-get install -y --no-install-recommends --allow-unauthenticated \
             binutils-mingw-w64 \
             g++-mingw-w64-x86-64 \
             libapparmor-dev \
@@ -141,7 +142,7 @@ ARG DEBIAN_FRONTEND
 RUN echo 'deb http://deb.debian.org/debian buster-backports main' > /etc/apt/sources.list.d/backports.list
 RUN --mount=type=cache,sharing=locked,id=moby-cross-true-aptlib,target=/var/lib/apt \
     --mount=type=cache,sharing=locked,id=moby-cross-true-aptcache,target=/var/cache/apt \
-        apt-get update && apt-get install -y --no-install-recommends \
+        apt-get update && apt-get install -y --no-install-recommends --allow-unauthenticated \
             libapparmor-dev:arm64 \
             libapparmor-dev:armel \
             libapparmor-dev:armhf \
-- 
2.25.1

